# Getting Started

## Supabase Setup
1. Head over to [supabase.com](https://supabase.com) and create a new database.
2. Create a new table called **readings** in the *public* schema.

The SQL definition for the table should look like this:
``` SQL
create table
  public.readings (
    id bigint generated by default as identity,
    sensor_id smallint not null,
    created_at timestamp with time zone not null default now(),
    temperature real null,
    humidity real null,
    constraint readings_pkey primary key (id),
    constraint readings_id_key unique (id),
  ) tablespace pg_default;
  ```

?> You can configure the table to your own needs. For example, you could add a column for air pressure or another one for CO2 levels.

## Logger Setup
You can connect as many loggers as you like. You can even attach you own sensors to the logger. Simply follow the steps below for each logger you make. 
Each logger can be controlled by either an `ESP8266` or an `ESP32`.

?> In order to start you must have [PlatformIO](https://platformio.org/) setup on your machine.

1. Duplicate the `logger/src/secrets_TEMPLATE.h` file and rename the duplicate to `secrets.h`.
2. Replace the values with the ones required for your project:
    - **WIFI_SSID**: The name of the your local WiFi network.
    - **WIFI_PASSWORD**: The password for your local WiFi network.
    - **SUPABASE_URL**: The URL of the database you created earlier. (Navigate to `settings -> API`)
    - **SUPABASE_KEY**: The anon public API key of the database you created earlier. (Navigate to `settings -> API`)
3. Update the value of **SENSOR_ID** in the `config.h` file. The ID needs to be a unique number from 0-255 for every sensor you make.
4. Compile and upload the code to your ESP32 or ESP8266 and you're good to go!

### Adding custom sensors
The project is setup to read an SHT21 temperature and humidity sensor by default. But you can customize the code to use whatever sensor modules you wish.

1. In `logger/src/main.cpp` replace the code inside the `setupSensors` function with the setup code required for your custom modules.
    - Return `true` if the sensors were successfully set up
    - Return `false` if the sensors failed to set up.
2. Replace the code inside the `readSensors` function with the setup code required for your custom modules.
    - Update the JSON object with the new data, e.g. `supaSense.json["temperature"] = temperature;`
    - Return `true` if the sensors were successfully read
    - Return `false` if the sensors failed to be read

As easy as that!

### Logger lifecycle
``` mermaid
flowchart LR;
    A[Wake up] --> B;
    B(Start serial) --> C;
    C{Connect to WiFi} -- fail (after 1min) --> A;
    C -- success --> D;
    D(Start Supabase client) --> E;
    E{Setup sensors} -- fail --> H;
    E -- success --> F;
    F{Read sensors} -- fail --> H;
    F -- success --> G;
    G{Upload readings} -- fail --> H;
    G -- success --> H;
    H[Deep sleep] -- 30min --> A;
```